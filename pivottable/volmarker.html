<link href="bower_components/angular-ui-grid/ui-grid.css" rel="stylesheet" type="text/css" />
<link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" type="text/css"/>

<link rel="stylesheet" href="css/angular-chart.css">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/volmarker.css">

<script type='text/javascript' src="bower_components/jquery/dist/jquery.min.js"></script>
<script type='text/javascript' src="bower_components/underscore/underscore-min.js"></script>
<script type='text/javascript' src="bower_components/angular/angular.min.js"></script>
<script type='text/javascript' src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
<script type='text/javascript' src="bower_components/ui-bootstrap/src/tooltip/tooltip.js"></script>
<script type='text/javascript' src="bower_components/bootstrap/js/tooltip.js"></script>
<script type='text/javascript' src="bower_components/angular-ui-grid/ui-grid.min.js"></script>
<script type="text/javascript" src="lib/ui-bootstrap-tpls-1.3.1.js"></script>
<script type="text/javascript" src="lib/angular-animate.js"></script>

<script type='text/javascript' src='lib/chart.js'></script>
<script type='text/javascript' src='lib/angular-chart.js'></script>
<script type='text/javascript' src="lib/numeric-1.2.6.js"></script>

<!-- Project specific libs -->
<script src="apps/volmarker.js"></script>
<script src="data/datawarehouse.js"></script>
<script src="services/utils.js"></script>
<script src="services/dateUtils.js"></script>
<script src="services/analytics.js"></script>
<script src="services/settings.js"></script>
<script src="services/voldata.js"></script>
<script src="services/volsurfacecollection.js"></script>
<script src="services/volmarkerUtils.js"></script>
<script src="services/chartService.js"></script>
<script src="services/dealerUtils.js"></script>
<script src="controllers/volmarkerCtrl.js"></script>
<script src="directives/volsurfacechart.js"></script>

<title>VolMarker</title>
<html ng-app="volmarker">
  <div ng-controller="volmarkerCtrl">

  <!-- SETTINGS MENU -->
  <div id='settingsMenu' class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title">VolMarker settings</h3>
      </div>
      <div class="modal-body">

        <form class="form-horizontal">

          <div class="form-group">
            <label for="pricingDate" class="col-sm-4 control-label">Pricing date</label>
            <div class="col-sm-8">
              <select id="pricingDate" name="date" ng-model="pricingDate">
                  <option ng-repeat="date in ['2016-4-12', '2016-4-11', '2016-4-8', '2016-4-7']" value="{{date}}" ng-selected="$index==0">{{date}}</option>
              </select>
            </div>
          </div>      

           <div class="form-group">
            <label for="f3" class="col-sm-4 control-label">Load metadata (slower)</label>
            <div class="col-sm-8">
            <input id="f3" type=checkbox ng-model='settings.withMetaData' /> 
            </div>
          </div>       

          <div class="form-group">
            <label for="f2" class="col-sm-4 control-label">Data mode</label>
            <div class="col-sm-8">
              <select id="f2" name="date" ng-model="settings.dataMode">
                  <option ng-repeat="mode in ['local','ajax','ajaxASP']" value="{{mode}}" ng-selected="settings.dataMode==mode">{{mode}}</option>
              </select>
            </div>
          </div>    

          <div class="form-group">
            <label  class="col-sm-4 control-label">Animation speed [{{settings.animationSpeed}}]</label>
            <div class="col-sm-8">
              <input type="range" ng-model='settings.animationSpeed' data-popup-enabled="true" min="1" max="10">
            </div>
          </div>    

          <div class="form-group">
            <label for="f3" class="col-sm-4 control-label">Show dealer details</label>
            <div class="col-sm-8">
            <input id="f3" type=checkbox ng-model='settings.showDealerDetails' /> 
            </div>
          </div>     

          <div class="form-group">
            <label for="f3" class="col-sm-4 control-label">Show settings at startup</label>
            <div class="col-sm-8">
            <input id="f3" type=checkbox ng-model='settings.loadMenuOnStartup' /> 
            </div>
          </div>     

          <div class="form-group">
            <label for="f3" class="col-sm-4 control-label">Show console</label>
            <div class="col-sm-8">
            <input id="f3" type=checkbox ng-model='settings.console' /> 
            </div>
          </div>     

          <div class="form-group">
            <label for="f4" class="col-sm-4 control-label">Underliers (leave blank for all)</label>
            <div class="col-sm-8">
              <input id="f4" type="text" class="form-control"  placeholder="" ng-model='settings.underliers'>
            </div>
          </div>   

          <div class="form-group">
            <label for="fwdvartenors" class="col-sm-4 control-label">Fwd var tenors</label>
            <div class="col-sm-8">
              <input id="fwdvartenors" type="text" class="form-control"  placeholder="" ng-model='settings.fwdVarTenors'>
            </div>
          </div>   

        </form>
      </div>
      <div class="modal-footer">
<!--         <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
 -->        <button type="button" class="btn btn-primary" ng-click='settings.Reset()'>Reset defaults</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


  <!-- 'LOADING' PAGE -->
  <div id='loadingPage' class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title">Loading data for {{pricingDate}}</h3>
      </div>
      <div class="modal-body">

          
        <span class="col-sm-4">
          <img src='assets/gears.gif' />
        </span>
        <span class="col-sm-4">
          <h1>Please wait...</h1>
        </span>
      </div>
      <div class="modal-footer">
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


    <!--    UNDERLIERS PANE -->
    <div class="col-md-2" id='underliersPane'>
      <div class="panel panel-primary">
        <div class="panel-heading">
          <button class="btn btn-info" ng-click="showSettingsMenu()">Settings</button>
          <span>
            <button class="btn" ng-class="requestBusy ? 'btn-warning' : 'btn-danger'" ng-click="setDateAndLoad()">{{ requestBusy ? "Loading..." : "Load" }}</button>
            <!--<button class="btn btn-danger" ng-click="refreshVolSurfaces()">Reload all</button>-->
          </span>
        </div>
          <div ng-if='initialized' class="panel-body list-group">
   
          <div ng-repeat="und in underliers" class="list-group-item" tooltip-placement='auto' 
          uib-tooltip-template="'metadataTemplate'" tooltip-class="customClass" 
            ng-click='setActiveUnderlier(und)'
            ng-class="{'active': und == $parent.activeUnderlier, 'leader' : isLeader(und), 'follower' : !isLeader(und), 'haschanges' : volSurfaceCollection.HasChanges(und) }">

              <!-- LIST OF INDICES  -->
              <div class='list-group-item-heading'>
                  <span><b>{{volSurfaceCollection.HasChanges(und)?'*'+und+'*' : und}}
                [{{points[und]}}]</b>
                <img ng-if='settings.showFlags' class=flag ng-src='{{regionFlag(und)}}'/>
              </span>
                  <div ng-if='!volSurfaceCollection.HasChanges(und)'>
                      <b>No changes</b>
                  </div>
                  <div ng-if='volSurfaceCollection.HasChanges(und)'>
                      <b>{{numberOfChanges(und)}} change{{numberOfChanges(und) > 1 ? "s" : ""}}</b>
                      <ul>
                          <li ng-repeat="change in volSurfaceCollection.changesStored[und]">{{change.obs}}: {{change.diff}}</li>
                      </ul>
                  </div>
                  <div ng-if='settings.showThumbnails'>
                      <vol-surface-chart volSurfaceCollection='volSurfaceCollection' underlier='und' showdatesonaxis=0 nolegend=1></vol-surface-chart>
                  </div>
              </div>

              <!-- METADATA TEMPLATE -->
              <script type="text/ng-template" id="metadataTemplate">
                  <span ng-if='settings.withMetaData && volSurfaceCollection.HasMetaData(und)'>
                         <h3>Sources for {{ und }}</h3>
                         <span ng-repeat='(source,metadata) in volSurfaceCollection.MetaData(und)'>
                         <h4>{{ dealerInfo[source].label }}</h4>
                            <ul>
                              <li><b>Time:</b> {{metadata.KnowledgeTime}}</li>
                              <li><b>Description:</b> {{metadata.Description}}</li>
                              <li><b>CommandLine:</b> {{metadata.CommandLine}}</li>
                            </ul>
                        </span>
                  </span>
                  <span ng-if='settings.withMetaData && !volSurfaceCollection.HasMetaData(und)'>
                        <h3 >No sources for {{ und }}</h3>
                  </span>
              </script>

          </div>
        </div>
        
      </div>
    </div>


    <!----    MARKING PANE -->

    <div class="col-md-4" id='markingPane'>
      <div class="panel panel-primary" >
        <div class="panel-heading">
          Var surface for  {{activeUnderlier}}
          <span>
            <button class="btn btn-danger" ng-if='volSurfaceCollection.HasChanges(activeUnderlier)' ng-click="save()">Save changes</button>
            <button class="btn btn-danger" ng-class="requestBusy ? 'btn-warning' : 'btn-danger'" ng-click="refreshVolSurfaces(true,activeUnderlier)">Reload</button>
          </span>
        </div>
        <div class="panel-body">
          <!-- THE DATA GRID -->
          <!-- <div class="col-md-12"> -->
            <div class="gridStyle" ui-grid="gridConfig" ui-grid-cellnav ui-grid-edit></div>
          <!-- </div> -->
         <!--  <div class="col-md-6">
            <div class=row>
              <div class="col-lg-12">
                <div class=row>
                </div>
                <div class=row>
                  <p>Reference spot: <b>{{surface().Spot()}}</b>
                    <p class='lastupdate'>Last update: <b>{{surface().Time()}} ({{surface().Age()}} ago)</b></p>
                                  </div>
                </div>
                
                <hr>
              </div>
              <div class=row>
                <vol-surface-chart volsurfacecollection='volsurfacecollection' underlier='activeUnderlier' listen=1 tooltip=1 type='' showdatesonaxis=1 >
                <b>BM estimate vs. dealers for {{activeUnderlier}}</b>
                </vol-surface-chart>
              </div>
              <div class=row>
                <vol-surface-chart volsurfacecollection='volsurfacecollection' underlier='activeUnderlier' listen=1 tooltip=1 type='basis' showdatesonaxis=1 />
              </div>
            </div>-->
          </div> 
        </div>
      </div>
      <!----    FWD VARIANCE PANE -->
      <div class="col-md-6" id='fwdVarPane'>
        <div class="panel panel-primary" >
          <div class="panel-heading">
            FwdVar surfaces for  {{activeUnderlier}}
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-md-12">
                <vol-surface-chart volSurfaceCollection='volSurfaceCollection' underlier='activeUnderlier' listen=1 tooltip=1 type='' showdatesonaxis=1 >
                <b>BM estimate vs. dealer for {{activeUnderlier}}</b>
                </vol-surface-chart>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <vol-surface-chart volSurfaceCollection='volSurfaceCollection' underlier='activeUnderlier' listen=1 tooltip=1 type='totalstdev' showdatesonaxis=1 nolegend=1>
                <b>Total StdDev (Var * sqrt(t))</b>
                </vol-surface-chart>
              </div>
              <div  class="col-md-6">
                <vol-surface-chart volSurfaceCollection='volSurfaceCollection' underlier='activeUnderlier'  listen=1 tooltip=1 type=ratio showdatesonaxis=1 nolegend=1>
                <b>Ratio to SPX</b>
                </vol-surface-chart>
              </div>
              <div ng-repeat="tenor in settings.fwdVarTenorsList()" class="col-md-6">
                <vol-surface-chart volSurfaceCollection='volSurfaceCollection' underlier='activeUnderlier'  listen=1 tooltip=1 type=fwd tenor='tenor' showdatesonaxis=1 nolegend=1>
                <b>{{tenor}} forward variance</b>
                </vol-surface-chart>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div ng-if='settings.console' id='console'></div>
    </html>
    <script>
    $("#underlier").focus();
    $(".gridStyle").css("height","85%");
    //$(".gridStyle").css("width","100%");
    </script>