<link href="css/jquery.treetable.theme.default.css" rel="stylesheet" type="text/css" />
<script src="lib/jquery.js"></script>
<script src="lib/underscore.js"></script>
<script src="lib/jquery.treetable.js"></script>
<script src="data.js"></script>
<script src="utils.js"></script>
<script src="pivottable.js"></script>
<script src="pivottablesource.js"></script>

<style>
      .hidden {
            visibility: hidden;
      }
</style>

  <table class='hidden' id="pivottable">
        <caption>
          <a href="#" onclick="jQuery('#pivottable').treetable('expandAll'); return false;">Expand all</a>
          <a href="#" onclick="jQuery('#pivottable').treetable('collapseAll'); return false;">Collapse all</a>
        </caption>
        <thead>
          <tr>
            <th id='pivotFieldSequence'></th>
          </tr>
        </thead>
        <tbody>
        </tbody>
  </table>

<script>



//data = data.filter(function(row) { return row["Qtr 1"] > 0; });

      
      

$(document).ready(function() {
      var table = $("#pivottable");
      var data = window.data.slice(0,100);
      var source = new PivotTableSourceFromTable(data);
      var id = 0;
      var valueFields = [ "Qtr 1", "Qtr 2", "Qtr 3", "Qtr 4" ];
      var pivots = [ "Product", "Customer" ];

      var treeModel = new PivotTable(table,source,pivots,valueFields);
      window.treeModel = treeModel;

      $("thead tr").append(valueFields.map(HTMLWrapper("th")));
      $("#pivotFieldSequence").html(pivots.join(" &gt;&gt; "));

      $(".hidden").removeClass("hidden");
      var values = valueFields
            .map(function() { return ""; })
            .map(HTMLWrapper("td"))
            .join("\n");
      var root = { parentid: -1, newid : 0, key: "Sales database", value: "", pivotLevel: 0, pivots: pivots, values: values };
      table.treetable("loadBranch",null,treeModel.rowTemplate(root));
      var rootNode = $("[data-tt-id='0']");
      rootNode.click();
})


</script>