<link href="css/jquery.treetable.theme.default.css" rel="stylesheet" type="text/css" />
<script src="lib/jquery.js"></script>
<script src="lib/underscore.js"></script>
<script src="lib/jquery.treetable.js"></script>
<script src="lib/angular.js"></script>
<script src="data.js"></script>
<script src="utils.js"></script>
<script src="pivottable.js"></script>
<script src="pivottablesource.js"></script>

<style>
      .hidden {
            visibility: hidden;
      }
</style>
<div ng-app="pivottable" ng-controller="pivottableCtrl">
<span>Started at: {{ startTime }}</span>
  <table class='hidden' id="pivottable">
        <caption>
          <a href="#" onclick="jQuery('#pivottable').treetable('expandAll'); return false;">Expand all</a>
          <a href="#" onclick="jQuery('#pivottable').treetable('collapseAll'); return false;">Collapse all</a>
        </caption>
        <thead>
        </thead>
        <tbody>
        </tbody>
  </table>
</div>

<script>


var app = angular.module('pivottable', 
      ['dataService','utilsService', 'pivotTableService', 'pivotTableSourceService'] );
app.controller("pivottableCtrl", function($scope,$,data,PivotTable, PivotTableSourceFromTable) {
      console.log("Starting pivottable at %s", new Date());
      $scope.startTime = new Date();

      // HTML placeholder
      var table = $("#pivottable");
      // data source
      var data = data.slice(0,100);
      var valueFields = [ "Qtr 1", "Qtr 2", "Qtr 3", "Qtr 4" ];
      var pivots = [ "Product", "Customer" ];

      $scope.valueFields = valueFields;
      $scope.pivots = pivots;

      var source = new PivotTableSourceFromTable(data, pivots, valueFields);

      var classes = [ "Folder", "File", "File" ];
      // pivottable
      var pivotTable = new PivotTable(table,source,pivots,valueFields,classes);

      $(".hidden").removeClass("hidden");
      pivotTable.queryNode(2);
} );

</script>